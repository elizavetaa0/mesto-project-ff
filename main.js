(()=>{"use strict";var t="https://mesto.nomoreparties.co/v1/wff-cohort-2",e={authorization:"08a43134-6ee2-4e78-92c0-d49d38caaecf","Content-Type":"application/json"},n=function(t){return t.ok?t.json():Promise.reject("Что-то пошло не так: ".concat(t.status))},o=document.querySelector("#card-template").content;function r(t){t.classList.toggle("card__like-button_is-active")}function c(r,c,a,i,u,l,s,p){var d=o.cloneNode(!0).querySelector(".card"),f=d.querySelector(".card__like-button"),_=d.querySelector(".card__image"),m=d.querySelector(".card__delete-button"),y=d.querySelector(".number-of-likes");return _.src=r.link,d.querySelector(".card__title").textContent=r.name,_.alt=r.name,y.textContent=u.length,i===a?(m.style.display="block",m.addEventListener("click",(function(){l(d,c)}))):m.style.display="none",f.addEventListener("click",(function(o){o.preventDefault(),f.classList.contains("card__like-button_is-active")?function(o){return fetch("".concat(t,"/cards/likes/").concat(o),{method:"DELETE",headers:{authorization:e.authorization}}).then(n)}(c).then((function(t){y.textContent=t.likes.length,s(f)})).catch((function(t){console.log("Ошибка при снятии лайка: ",t)})):function(o){return fetch("".concat(t,"/cards/likes/").concat(o),{method:"PUT",headers:{authorization:e.authorization}}).then(n)}(c).then((function(t){y.textContent=t.likes.length,s(f)})).catch((function(t){console.log("Ошибка при постановке лайка: ",t)}))})),_.addEventListener("click",(function(t){t.preventDefault(),p(t)})),u.some((function(t){return t._id===a}))&&f.classList.add("card__like-button_is-active"),d}function a(o,r){(function(o){return fetch("".concat(t,"/cards/").concat(o),{method:"DELETE",headers:{authorization:e.authorization}}).then(n)})(r).then((function(){o.remove()})).catch((function(t){return console.log("Ошибка при удалении карточки: ",t)}))}function i(t){t.classList.add("popup_is-opened"),t.addEventListener("click",s),document.addEventListener("keydown",l)}function u(t){t.classList.remove("popup_is-opened"),t.removeEventListener("click",s),document.removeEventListener("keydown",l)}function l(t){"Escape"===t.key&&u(document.querySelector(".popup_is-opened"))}function s(t){if(t.target.classList.contains("popup")||t.target.classList.contains("popup__close")){var e=t.currentTarget;e&&u(e)}}var p=function(t,e){t.setAttribute("disabled",!0),t.classList.add(e.inactiveButtonClass)},d=function(t,e,n){var o=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(n.inputErrorClass),o.textContent="",o.classList.remove(n.errorClass)},f=function(t,e){t.querySelectorAll(e.inputSelector).forEach((function(n){d(t,n,e),n.setCustomValidity("")}));var n=t.querySelector(e.submitButtonSelector);p(n,e)},_=function(t,e,n){!function(t){return Array.from(t).some((function(t){return!t.validity.valid}))}(t)?(e.classList.remove(n.inactiveButtonClass),e.removeAttribute("disabled")):p(e,n)},m={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function y(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}var v,h=document.querySelector(".places__list"),S=document.querySelector(".profile__add-button"),b=document.querySelector(".profile__edit-button"),g=document.querySelector(".popup_type_new-card"),q=document.querySelector(".popup_type_edit"),C=document.querySelector(".popup_type_image"),k=document.querySelector(".popup_type_avatar-edit"),E=document.querySelector(".popup__input_type_name"),L=document.querySelector(".popup__input_type_description"),w=document.querySelector(".popup__input_type_card-name"),A=document.querySelector(".popup__input_type_url"),x=C.querySelector(".popup__image"),z=C.querySelector(".popup__caption"),T=document.querySelector(".profile__title"),j=document.querySelector(".profile__description"),D=document.forms["new-place"],O=document.forms["avatar-edit"],B=document.querySelector(".profile__image"),P=document.querySelector(".popup__input_type_avatar");function I(t){t.preventDefault(),i(C);var e=t.target.src,n=t.target.alt;x.src=e,z.textContent=n}function M(t,e){t.textContent=e}Promise.all([fetch("".concat(t,"/users/me"),{headers:{authorization:e.authorization}}).then(n),fetch("".concat(t,"/cards"),{headers:{authorization:e.authorization}}).then(n)]).then((function(t){var e,n,o=(n=2,function(t){if(Array.isArray(t))return t}(e=t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var o,r,c,a,i=[],u=!0,l=!1;try{if(c=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(o=c.call(n)).done)&&(i.push(o.value),i.length!==e);u=!0);}catch(t){l=!0,r=t}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw r}}return i}}(e,n)||function(t,e){if(t){if("string"==typeof t)return y(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?y(t,e):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),i=o[0],u=o[1];v=i._id,document.querySelector(".profile__title").textContent=i.name,document.querySelector(".profile__description").textContent=i.about,document.querySelector(".profile__image").style.backgroundImage="url(".concat(i.avatar,")"),u.forEach((function(t){var e=t._id,n=t.likes,o=t.owner._id,i=c(t,e,v,o,n,a,r,I);h.appendChild(i)}))})).catch((function(t){return console.log("Ошибка при загрузке данных: ",t)})),function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];e.forEach((function(t){t&&t.classList.add("popup_is-animated")}))}(g,q,C,k),S.addEventListener("click",(function(){D.reset(),f(D,m),i(g)})),b.addEventListener("click",(function(){f(q,m),i(q),E.value=T.textContent,L.value=j.textContent})),B.addEventListener("click",(function(){O.reset(),f(O,m),i(k)})),document.querySelectorAll(".popup__close").forEach((function(t){var e=t.closest(".popup");t.addEventListener("click",(function(){return u(e)}))})),q.addEventListener("submit",(function(o){o.preventDefault();var r=q.querySelector(".popup__button");M(r,"Сохранение...");var c,a,i=E.value,l=L.value;T.textContent=i,j.textContent=l,(c=i,a=l,fetch("".concat(t,"/users/me"),{method:"PATCH",headers:{authorization:e.authorization,"Content-Type":"application/json"},body:JSON.stringify({name:c,about:a})}).then(n).then((function(t){return t}))).then((function(t){T.textContent=i,j.textContent=l,u(q)})).catch((function(t){console.log("Ошибка при обновлении данных: ",t)})).finally((function(){M(r,"Сохранить")}))})),D.addEventListener("submit",(function(o){o.preventDefault();var i,l,s=q.querySelector(".popup__button");M(g.querySelector(".popup__button"),"Сохранение..."),(i=w.value,l=A.value,fetch("".concat(t,"/cards"),{method:"POST",headers:{authorization:e.authorization,"Content-Type":"application/json"},body:JSON.stringify({name:i,link:l})}).then(n)).then((function(t){var e,n,i,l;e={likes:t.likes,_id:t._id,name:t.name,link:t.link,owner:{name:t.owner.name,about:t.owner.about,avatar:t.owner.avatar,_id:t.owner._id,cohort:t.owner.cohort},createdAt:t.createdAt},n=e._id,i=e.owner._id,l=c(e,n,v,i,e.likes,a,r,I),h.prepend(l),o.target.reset(),u(g)})).catch((function(t){console.log("Ошибка при добавлении новой карточки: ",t)})).finally((function(){M(s,"Сохранить")}))})),O.addEventListener("submit",(function(o){o.preventDefault();var r,c=k.querySelector(".popup__button");M(c,"Сохранение..."),(r=P.value,fetch("".concat(t,"/users/me/avatar"),{method:"PATCH",headers:{authorization:e.authorization,"Content-Type":"application/json"},body:JSON.stringify({avatar:r})}).then(n)).then((function(t){document.querySelector(".profile__image").style.backgroundImage="url(".concat(t.avatar,")"),u(k)})).catch((function(t){console.log("Ошибка при обновлении аватара: ",t)})).finally((function(){M(c,"Сохранить")}))})),function(t){document.querySelectorAll(t.formSelector).forEach((function(e){e.addEventListener("submit",(function(t){t.preventDefault()})),function(t,e){var n=t.querySelectorAll(e.inputSelector),o=t.querySelector(e.submitButtonSelector);_(n,o,e),n.forEach((function(r){r.addEventListener("input",(function(r){!function(t,e,n){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?d(t,e,n):function(t,e,n,o){var r=t.querySelector(".".concat(e.id,"-error"));e.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(t,e,e.validationMessage,n)}(t,r.target,e),_(n,o,e)}))}))}(e,t)}))}(m)})();
//# sourceMappingURL=main.js.map